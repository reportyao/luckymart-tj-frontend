<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# å¤ºå®ç®¡ç†é¡µé¢ - åˆ›å»º/ç¼–è¾‘å¤ºå®å•†å“åŠŸèƒ½å®Œå–„ï¼Œè¿™ä¸ªè¦è€ƒè™‘ä¸‰ç§è¯­è¨€çš„åˆ‡æ¢ï¼Œéœ€è¦äººå·¥ä¸Šä¼ ä¸åŒè¯­è¨€çš„ç®€ä»‹å†…å®¹

ç”¨æˆ·å……å€¼é“¶è¡Œå‚æ•°å½•å…¥åŠŸèƒ½ç¼ºå¤±ï¼Œè¿™ä¸ªä½ ç†è§£é”™äº†ï¼Œæˆ‘è¯´çš„æ˜¯å‰ç«¯ç”¨æˆ·ç‚¹å‡»å……å€¼ï¼Œæ‰€çœ‹åˆ°çš„é“¶è¡Œä¿¡æ¯éƒ¨åˆ†ï¼Œåœ¨ç®¡ç†åå°è¿™é‡Œè¦å¯¹åº”æœ‰å¯ä»¥å¡«å†™çš„åœ°æ–¹
å¢åŠ ä¸€ä¸ªå¤šå±‚çº§ç”¨æˆ·ç®¡ç†çš„é¡µé¢ï¼Œè¦é…åˆç°åœ¨å‰ç«¯çš„UIé¡µé¢ï¼Œæ”¯æŒå¤šå±‚çº§çš„è¿”åˆ©è®¾ç½®ç­‰ç­‰å¯¹åº”åŠŸèƒ½ï¼Œåœ¨ç®¡ç†åå°è¦æœ‰å¯¹åº”è®¾ç½®å…¥å£
å¢åŠ ç°åœ¨å¼€å¥–ç®—æ³•çš„ç®¡ç†åå°ç®¡ç†å…¥å£ï¼Œå’Œç°åœ¨å‰ç«¯å¼€å¥–éƒ¨åˆ†é…åˆ

æ ¹æ®æˆ‘ä¸Šé¢çš„å†…å®¹ï¼Œå†ç”Ÿæˆå¯¹åº”çš„å¼€å‘æ–‡æ¡£ï¼Œç»™aiçœ‹

åŸºäºä½ çš„è¡¥å……è¯´æ˜ï¼Œæˆ‘é‡æ–°ç”Ÿæˆæ›´ç²¾å‡†ã€æ›´ç»†è‡´çš„æŠ€æœ¯å¼€å‘æ–‡æ¡£ï¼š

***

# TezBarakat ç®¡ç†åå°åŠŸèƒ½è¡¥å…¨å¼€å‘æ–‡æ¡£ï¼ˆä¿®è®¢ç‰ˆï¼‰

**ç›®æ ‡å—ä¼—**ï¼šAI å¼€å‘å·¥ç¨‹å¸ˆ / Manus AI
**éƒ¨ç½²ç¯å¢ƒ**ï¼š47.243.83.253 æœåŠ¡å™¨
**å‰ç«¯å‚è€ƒ**ï¼štezbarakat-tj-frontendï¼ˆæ”¯æŒä¸­æ–‡/ä¿„è¯­/å¡”å‰å…‹è¯­ä¸‰è¯­è¨€ï¼‰
**æ•°æ®åº“**ï¼šSupabase (owyitxwxmxwbkqgzffdw.supabase.co)

***

## 1. å¤ºå®ç®¡ç† - åˆ›å»º/ç¼–è¾‘å¤ºå®ï¼ˆå¤šè¯­è¨€å†…å®¹ç®¡ç†ï¼‰

### éœ€æ±‚æè¿°

ç®¡ç†å‘˜åˆ›å»º/ç¼–è¾‘å¤ºå®å•†å“æ—¶ï¼Œéœ€è¦ä¸º**ä¸‰ç§è¯­è¨€ï¼ˆzh/ru/tgï¼‰åˆ†åˆ«ä¸Šä¼ å†…å®¹**ï¼š

- å•†å“åç§°
- å•†å“æè¿°
- å•†å“è¯¦æƒ…ï¼ˆå¯Œæ–‡æœ¬ï¼‰

ç”¨æˆ·åœ¨å‰ç«¯åˆ‡æ¢è¯­è¨€æ—¶ï¼Œæ˜¾ç¤ºå¯¹åº”è¯­è¨€ç‰ˆæœ¬çš„å†…å®¹ã€‚

***

### æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

#### è¡¨ï¼š`lotteries`

```sql
CREATE TABLE lotteries (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  -- åŸºæœ¬ä¿¡æ¯
  status lottery_status NOT NULL DEFAULT 'CREATED',
  total_shares INTEGER NOT NULL,
  price_per_share NUMERIC(10,2) NOT NULL,
  sold_shares INTEGER DEFAULT 0,
  
  -- å¤šè¯­è¨€å†…å®¹ï¼ˆJSON å­—æ®µï¼‰
  name_i18n JSONB NOT NULL,
  -- ç¤ºä¾‹: {"zh": "iPhone 15 Pro", "ru": "iPhone 15 Pro", "tg": "iPhone 15 Pro"}
  
  description_i18n JSONB NOT NULL,
  -- ç¤ºä¾‹: {"zh": "å…¨æ–°æœªæ‹†å°", "ru": "ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ°Ğ½Ğ½Ñ‹Ğ¹", "tg": "ĞĞ°Ğ²Ğ¸ Ğ±Ğ°ÑÑ‚Ğ°Ğ±Ğ°Ğ½Ğ´Ó£"}
  
  details_i18n JSONB,
  -- ç¤ºä¾‹: {"zh": "<p>è¯¦ç»†ä»‹ç»...</p>", "ru": "<p>ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ...</p>", ...}
  
  -- å›¾ç‰‡ï¼ˆå¤šè¯­è¨€å¯å…±ç”¨æˆ–åˆ†å¼€ï¼‰
  images JSONB NOT NULL,
  -- ç¤ºä¾‹: ["https://cdn.example.com/img1.jpg", "https://cdn.example.com/img2.jpg"]
  -- å¦‚éœ€å¤šè¯­è¨€å›¾ç‰‡: {"zh": ["url1"], "ru": ["url2"], "tg": ["url3"]}
  
  -- æ—¶é—´
  start_time TIMESTAMP WITH TIME ZONE NOT NULL,
  end_time TIMESTAMP WITH TIME ZONE NOT NULL,
  draw_time TIMESTAMP WITH TIME ZONE,
  
  -- ç®—æ³•ç›¸å…³
  algorithm_type VARCHAR(50) DEFAULT 'standard',
  algorithm_params JSONB,
  
  -- ä¸­å¥–ä¿¡æ¯
  winner_user_id UUID REFERENCES users(id),
  winning_number INTEGER,
  
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æšä¸¾ç±»å‹ï¼ˆç¡®ä¿åŒ…å«æ‰€æœ‰çŠ¶æ€ï¼‰
CREATE TYPE lottery_status AS ENUM (
  'CREATED',      -- å·²åˆ›å»º
  'STARTED',      -- è¿›è¡Œä¸­
  'PAUSED',       -- å·²æš‚åœ
  'SOLD_OUT',     -- å·²å”®ç½„
  'DRAWING',      -- å¼€å¥–ä¸­
  'FINISHED'      -- å·²å®Œæˆ
);
```


***

### ç®¡ç†åå° UI è®¾è®¡

#### åˆ›å»º/ç¼–è¾‘å¤ºå®è¡¨å•ï¼ˆåˆ† Tab åˆ‡æ¢ï¼‰

```tsx
// è¡¨å•ç»“æ„ç¤ºä¾‹
interface LotteryFormData {
  // åŸºæœ¬ä¿¡æ¯
  totalShares: number
  pricePerShare: number
  startTime: string
  endTime: string
  algorithmType: 'standard' | 'vrf' | 'hash'
  
  // å¤šè¯­è¨€å†…å®¹ï¼ˆTab åˆ‡æ¢ï¼‰
  nameZh: string
  nameRu: string
  nameTg: string
  
  descriptionZh: string
  descriptionRu: string
  descriptionTg: string
  
  detailsZh: string  // å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
  detailsRu: string
  detailsTg: string
  
  // å›¾ç‰‡ä¸Šä¼ 
  images: string[]  // é€šç”¨å›¾ç‰‡ URL æ•°ç»„
}
```


#### UI å¸ƒå±€ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºå¤ºå®                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºæœ¬ä¿¡æ¯                                        â”‚
â”‚  â”œâ”€ æ€»ä»½æ•°: [____]                              â”‚
â”‚  â”œâ”€ æ¯ä»½ä»·æ ¼: [____]                            â”‚
â”‚  â”œâ”€ å¼€å§‹æ—¶é—´: [æ—¥æœŸé€‰æ‹©å™¨]                       â”‚
â”‚  â”œâ”€ ç»“æŸæ—¶é—´: [æ—¥æœŸé€‰æ‹©å™¨]                       â”‚
â”‚  â””â”€ å¼€å¥–ç®—æ³•: [ä¸‹æ‹‰é€‰æ‹©: æ ‡å‡†/VRF/å“ˆå¸Œ]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å•†å“ä¿¡æ¯ (å¤šè¯­è¨€)                               â”‚
â”‚  â”Œâ”€ Tabs: [ä¸­æ–‡] [Ğ ÑƒÑÑĞºĞ¸Ğ¹] [Ğ¢Ğ¾Ò·Ğ¸ĞºÓ£] â”€â”        â”‚
â”‚  â”‚                                      â”‚        â”‚
â”‚  â”‚  å•†å“åç§°: [________________]        â”‚        â”‚
â”‚  â”‚  ç®€çŸ­æè¿°: [________________]        â”‚        â”‚
â”‚  â”‚            [________________]        â”‚        â”‚
â”‚  â”‚  è¯¦ç»†ä»‹ç»: [å¯Œæ–‡æœ¬ç¼–è¾‘å™¨______]      â”‚        â”‚
â”‚  â”‚            [________________]        â”‚        â”‚
â”‚  â”‚            [________________]        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å•†å“å›¾ç‰‡                                        â”‚
â”‚  [ä¸Šä¼ å›¾ç‰‡] [å›¾ç‰‡1] [å›¾ç‰‡2] [å›¾ç‰‡3]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å–æ¶ˆ]                           [ä¿å­˜å¹¶å‘å¸ƒ]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

### åç«¯ API å®ç°

#### åˆ›å»ºå¤ºå®æ¥å£

```typescript
// POST /api/admin/lotteries
async function createLottery(req, res) {
  const {
    totalShares,
    pricePerShare,
    startTime,
    endTime,
    algorithmType,
    
    // å¤šè¯­è¨€å†…å®¹
    nameZh, nameRu, nameTg,
    descriptionZh, descriptionRu, descriptionTg,
    detailsZh, detailsRu, detailsTg,
    
    images
  } = req.body

  // æ ¡éªŒ
  if (!nameZh || !nameRu || !nameTg) {
    return res.status(400).json({ error: 'æ‰€æœ‰è¯­è¨€çš„å•†å“åç§°å¿…å¡«' })
  }

  // ç»„è£…å¤šè¯­è¨€ JSON
  const nameI18n = { zh: nameZh, ru: nameRu, tg: nameTg }
  const descriptionI18n = { zh: descriptionZh, ru: descriptionRu, tg: descriptionTg }
  const detailsI18n = { zh: detailsZh, ru: detailsRu, tg: detailsTg }

  // å†™å…¥æ•°æ®åº“
  const { data, error } = await supabase
    .from('lotteries')
    .insert({
      status: 'CREATED',
      total_shares: totalShares,
      price_per_share: pricePerShare,
      name_i18n: nameI18n,
      description_i18n: descriptionI18n,
      details_i18n: detailsI18n,
      images,
      start_time: startTime,
      end_time: endTime,
      algorithm_type: algorithmType
    })
    .select()
    .single()

  if (error) {
    return res.status(500).json({ error: error.message })
  }

  return res.json({ success: true, lottery: data })
}
```


***

## 2. å……å€¼é“¶è¡Œå‚æ•°é…ç½®ï¼ˆç®¡ç†åå°å½•å…¥ï¼Œå‰ç«¯å±•ç¤ºï¼‰

### éœ€æ±‚æè¿°

**å‰ç«¯ç”¨æˆ·ç‚¹å‡»å……å€¼æ—¶ï¼Œä¼šçœ‹åˆ°"é“¶è¡Œè½¬è´¦ä¿¡æ¯"**ï¼ŒåŒ…æ‹¬ï¼š

- æ”¶æ¬¾é“¶è¡Œåç§°
- æ”¶æ¬¾è´¦æˆ·å
- æ”¶æ¬¾è´¦å·
- æ”¯è¡Œä¿¡æ¯
- è½¬è´¦å¤‡æ³¨è¯´æ˜

è¿™äº›ä¿¡æ¯éœ€è¦**åœ¨ç®¡ç†åå°å¯é…ç½®**ï¼Œæ”¯æŒå¤šä¸ªé“¶è¡Œè´¦æˆ·ã€å¤šè¯­è¨€å±•ç¤ºã€‚

***

### æ•°æ®åº“è¡¨ç»“æ„

#### è¡¨ï¼š`payment_methods`

```sql
CREATE TABLE payment_methods (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  type VARCHAR(50) NOT NULL,  -- 'bank_transfer', 'alipay', 'wechat', etc.
  status VARCHAR(20) DEFAULT 'active',  -- 'active', 'inactive'
  
  -- é“¶è¡Œä¿¡æ¯ï¼ˆå¤šè¯­è¨€ï¼‰
  bank_name_i18n JSONB,
  -- ç¤ºä¾‹: {"zh": "ä¸­å›½å·¥å•†é“¶è¡Œ", "ru": "ICBC China", "tg": "Ğ‘Ğ¾Ğ½ĞºĞ¸ ICBC"}
  
  account_name VARCHAR(100) NOT NULL,
  account_number VARCHAR(100) NOT NULL,
  
  branch_name_i18n JSONB,
  -- ç¤ºä¾‹: {"zh": "æ·±åœ³å—å±±æ”¯è¡Œ", "ru": "Ğ¤Ğ¸Ğ»Ğ¸Ğ°Ğ» Ğ¨ÑĞ½ÑŒÑ‡Ğ¶ÑĞ½ÑŒ", "tg": "Ğ¨Ğ¾Ñ…Ğ°Ğ¸ Ğ¨ÑĞ½ÑŒÑ‡Ğ¶ÑĞ½ÑŒ"}
  
  transfer_note_i18n JSONB,
  -- ç¤ºä¾‹: {"zh": "è¯·å¤‡æ³¨ç”¨æˆ·ID", "ru": "Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", ...}
  
  -- å¤„ç†æ—¶é—´/è´¹ç‡ç­‰
  processing_time_minutes INTEGER DEFAULT 30,
  min_amount NUMERIC(10,2) DEFAULT 10.00,
  max_amount NUMERIC(10,2) DEFAULT 50000.00,
  
  sort_order INTEGER DEFAULT 0,  -- æ˜¾ç¤ºé¡ºåº
  
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```


***

### ç®¡ç†åå° UI è®¾è®¡

#### æ”¯ä»˜æ–¹å¼ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ”¯ä»˜æ–¹å¼é…ç½®                    [+ æ·»åŠ æ–°æ–¹å¼]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é“¶è¡Œè½¬è´¦é…ç½®                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç±»å‹: é“¶è¡Œè½¬è´¦       çŠ¶æ€: â—å¯ç”¨        â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚ [ä¸­æ–‡] [Ğ ÑƒÑÑĞºĞ¸Ğ¹] [Ğ¢Ğ¾Ò·Ğ¸ĞºÓ£]             â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚ é“¶è¡Œåç§°: ä¸­å›½å·¥å•†é“¶è¡Œ                   â”‚   â”‚
â”‚  â”‚ è´¦æˆ·å:   TezBarakat æ”¶æ¬¾è´¦æˆ·            â”‚   â”‚
â”‚  â”‚ è´¦å·:     6222 **** **** 1234           â”‚   â”‚
â”‚  â”‚ æ”¯è¡Œ:     æ·±åœ³å—å±±æ”¯è¡Œ                   â”‚   â”‚
â”‚  â”‚ è½¬è´¦å¤‡æ³¨: è¯·å¤‡æ³¨æ‚¨çš„ç”¨æˆ·ID               â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚ å¤„ç†æ—¶é—´: 30 åˆ†é’Ÿ                       â”‚   â”‚
â”‚  â”‚ æœ€å°é‡‘é¢: 10.00                         â”‚   â”‚
â”‚  â”‚ æœ€å¤§é‡‘é¢: 50000.00                      â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚ [ç¼–è¾‘] [åˆ é™¤] [ç¦ç”¨]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### è¡¨å•å­—æ®µï¼ˆæ”¯æŒå¤šè¯­è¨€ï¼‰

```typescript
interface PaymentMethodForm {
  type: 'bank_transfer' | 'alipay' | 'wechat'
  status: 'active' | 'inactive'
  
  // å¤šè¯­è¨€å­—æ®µ
  bankNameZh: string
  bankNameRu: string
  bankNameTg: string
  
  accountName: string  // æ”¶æ¬¾äººåç§°ï¼ˆé€šå¸¸ä¸éœ€è¦å¤šè¯­è¨€ï¼‰
  accountNumber: string
  
  branchNameZh: string
  branchNameRu: string
  branchNameTg: string
  
  transferNoteZh: string
  transferNoteRu: string
  transferNoteTg: string
  
  processingTimeMinutes: number
  minAmount: number
  maxAmount: number
}
```


***

### å‰ç«¯è·å–æ¥å£

```typescript
// GET /api/payment-methods?type=bank_transfer&status=active
// å‰ç«¯æ ¹æ®ç”¨æˆ·å½“å‰è¯­è¨€æ˜¾ç¤ºå¯¹åº”å†…å®¹

const { data: paymentMethods } = await supabase
  .from('payment_methods')
  .select('*')
  .eq('type', 'bank_transfer')
  .eq('status', 'active')
  .order('sort_order')

// å‰ç«¯å±•ç¤ºé€»è¾‘
const currentLang = i18n.language  // 'zh' | 'ru' | 'tg'
const bankName = paymentMethod.bank_name_i18n[currentLang]
```


***

## 3. å¤šå±‚çº§ç”¨æˆ·ç®¡ç†ä¸è¿”åˆ©è®¾ç½®

### éœ€æ±‚æè¿°

- æ”¯æŒ**3çº§æ¨èè¿”åˆ©ä½“ç³»**ï¼ˆå‰ç«¯å·²æœ‰é‚€è¯·åŠŸèƒ½ï¼‰
- ç®¡ç†åå°éœ€è¦ï¼š

1. æŸ¥çœ‹ç”¨æˆ·é‚€è¯·å…³ç³»æ ‘ï¼ˆå¤šå±‚çº§ï¼‰
2. è®¾ç½®å„çº§è¿”åˆ©æ¯”ä¾‹
3. æŸ¥çœ‹å„ç”¨æˆ·çš„è¿”åˆ©ç»Ÿè®¡
4. æ‰‹åŠ¨è°ƒæ•´/å†»ç»“è¿”åˆ©

***

### æ•°æ®åº“è¡¨ç»“æ„

#### è¡¨ï¼š`users`ï¼ˆæ‰©å±•å­—æ®µï¼‰

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS referrer_id UUID REFERENCES users(id);
ALTER TABLE users ADD COLUMN IF NOT EXISTS referral_code VARCHAR(20) UNIQUE;
ALTER TABLE users ADD COLUMN IF NOT EXISTS referral_level INTEGER DEFAULT 0;
```


#### è¡¨ï¼š`commission_settings`ï¼ˆè¿”åˆ©é…ç½®ï¼‰

```sql
CREATE TABLE commission_settings (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  level INTEGER NOT NULL,  -- 1, 2, 3
  rate NUMERIC(5,4) NOT NULL,  -- 0.0500 = 5%
  
  description_i18n JSONB,
  -- ç¤ºä¾‹: {"zh": "ä¸€çº§æ¨è5%", "ru": "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1: 5%", ...}
  
  is_active BOOLEAN DEFAULT true,
  
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  UNIQUE(level)
);

-- é»˜è®¤é…ç½®
INSERT INTO commission_settings (level, rate, description_i18n) VALUES
(1, 0.0500, '{"zh": "ä¸€çº§æ¨èè¿”åˆ©", "ru": "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1", "tg": "Ğ¡Ğ°Ñ‚Ò³Ğ¸ 1"}'),
(2, 0.0300, '{"zh": "äºŒçº§æ¨èè¿”åˆ©", "ru": "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2", "tg": "Ğ¡Ğ°Ñ‚Ò³Ğ¸ 2"}'),
(3, 0.0100, '{"zh": "ä¸‰çº§æ¨èè¿”åˆ©", "ru": "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3", "tg": "Ğ¡Ğ°Ñ‚Ò³Ğ¸ 3"}');
```


#### è¡¨ï¼š`commissions`ï¼ˆè¿”åˆ©è®°å½•ï¼‰

```sql
CREATE TABLE commissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  user_id UUID NOT NULL REFERENCES users(id),  -- è·å¾—è¿”åˆ©çš„ç”¨æˆ·
  referrer_id UUID NOT NULL REFERENCES users(id),  -- äº§ç”Ÿæ¶ˆè´¹çš„ä¸‹çº§ç”¨æˆ·
  
  order_id UUID REFERENCES orders(id),
  order_amount NUMERIC(10,2) NOT NULL,
  
  level INTEGER NOT NULL,  -- 1, 2, 3
  rate NUMERIC(5,4) NOT NULL,
  commission_amount NUMERIC(10,2) NOT NULL,
  
  status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'paid', 'frozen'
  
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  paid_at TIMESTAMP WITH TIME ZONE
);
```


***

### ç®¡ç†åå° UI è®¾è®¡

#### 1. è¿”åˆ©è®¾ç½®é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”åˆ©è®¾ç½®                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨èè¿”åˆ©æ¯”ä¾‹é…ç½®                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å±‚çº§    è¿”åˆ©æ¯”ä¾‹    è¯´æ˜              çŠ¶æ€â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ä¸€çº§    5.00%      ç›´æ¥æ¨è           â—å¯ç”¨â”‚   â”‚
â”‚  â”‚ äºŒçº§    3.00%      äºŒçº§æ¨è           â—å¯ç”¨â”‚   â”‚
â”‚  â”‚ ä¸‰çº§    1.00%      ä¸‰çº§æ¨è           â—å¯ç”¨â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  [ç¼–è¾‘è¿”åˆ©æ¯”ä¾‹]                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿”åˆ©è§„åˆ™è¯´æ˜                                    â”‚
â”‚  â€¢ ç”¨æˆ·Aé‚€è¯·ç”¨æˆ·Bï¼ŒBæ¶ˆè´¹æ—¶Aè·å¾—5%è¿”åˆ©           â”‚
â”‚  â€¢ ç”¨æˆ·Bé‚€è¯·ç”¨æˆ·Cï¼ŒCæ¶ˆè´¹æ—¶Aè·å¾—3%ï¼ŒBè·å¾—5%      â”‚
â”‚  â€¢ è¿”åˆ©å®æ—¶åˆ°è´¦ï¼Œå¯åœ¨é’±åŒ…æŸ¥çœ‹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### 2. ç”¨æˆ·é‚€è¯·å…³ç³»æ ‘é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·é‚€è¯·å…³ç³»                   [æœç´¢: ______]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š ç”¨æˆ·: user123                               â”‚
â”‚      â”œâ”€ ä¸€çº§é‚€è¯· (5äºº)                          â”‚
â”‚      â”‚   â”œâ”€ user456 (æ¶ˆè´¹: Â¥1,200)             â”‚
â”‚      â”‚   â”‚   â””â”€ äºŒçº§é‚€è¯· (2äºº)                  â”‚
â”‚      â”‚   â”‚       â”œâ”€ user789 (æ¶ˆè´¹: Â¥500)       â”‚
â”‚      â”‚   â”‚       â””â”€ user101 (æ¶ˆè´¹: Â¥300)       â”‚
â”‚      â”‚   â”œâ”€ user112 (æ¶ˆè´¹: Â¥800)               â”‚
â”‚      â”‚   â””â”€ ...                                â”‚
â”‚      â”‚                                          â”‚
â”‚      â””â”€ è¿”åˆ©ç»Ÿè®¡                                â”‚
â”‚          â”œâ”€ ä¸€çº§è¿”åˆ©: Â¥150                      â”‚
â”‚          â”œâ”€ äºŒçº§è¿”åˆ©: Â¥24                       â”‚
â”‚          â”œâ”€ ä¸‰çº§è¿”åˆ©: Â¥5                        â”‚
â”‚          â””â”€ æ€»è®¡: Â¥179                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### 3. è¿”åˆ©è®°å½•ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”åˆ©è®°å½•                   [å¯¼å‡ºExcel]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰: [ç”¨æˆ·ID] [å±‚çº§â–¼] [çŠ¶æ€â–¼] [æ—¥æœŸèŒƒå›´]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´          ç”¨æˆ·      è®¢å•    å±‚çº§  é‡‘é¢  çŠ¶æ€â”‚
â”‚  11-17 10:30  user123  #12345   1çº§  Â¥50  å·²å‘æ”¾â”‚
â”‚  11-17 09:15  user123  #12346   2çº§  Â¥15  å·²å‘æ”¾â”‚
â”‚  11-16 15:20  user456  #12300   1çº§  Â¥100 å¾…å‘æ”¾â”‚
â”‚  ...                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æ‰¹é‡å‘æ”¾] [æ‰¹é‡å†»ç»“] [å¯¼å‡ºæŠ¥è¡¨]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

### åç«¯ API å®ç°

#### è·å–ç”¨æˆ·é‚€è¯·æ ‘

```typescript
// GET /api/admin/users/:userId/referral-tree
async function getUserReferralTree(userId: string) {
  // é€’å½’æŸ¥è¯¢3å±‚é‚€è¯·å…³ç³»
  const level1 = await supabase
    .from('users')
    .select('id, username, total_spent')
    .eq('referrer_id', userId)

  // å¯¹æ¯ä¸ªä¸€çº§ç”¨æˆ·æŸ¥è¯¢äºŒçº§
  for (const user of level1) {
    user.children = await supabase
      .from('users')
      .select('id, username, total_spent')
      .eq('referrer_id', user.id)
    
    // å¯¹æ¯ä¸ªäºŒçº§ç”¨æˆ·æŸ¥è¯¢ä¸‰çº§
    for (const child of user.children) {
      child.children = await supabase
        .from('users')
        .select('id, username, total_spent')
        .eq('referrer_id', child.id)
    }
  }

  return level1
}
```


#### æ›´æ–°è¿”åˆ©æ¯”ä¾‹

```typescript
// PUT /api/admin/commission-settings/:level
async function updateCommissionRate(level: number, rate: number) {
  // æ ¡éªŒ
  if (rate < 0 || rate > 1) {
    throw new Error('è¿”åˆ©æ¯”ä¾‹å¿…é¡»åœ¨0-100%ä¹‹é—´')
  }

  const { error } = await supabase
    .from('commission_settings')
    .update({ rate, updated_at: new Date().toISOString() })
    .eq('level', level)

  if (error) throw error

  return { success: true }
}
```


***

## 4. å¼€å¥–ç®—æ³•ç®¡ç†å…¥å£

### éœ€æ±‚æè¿°

ç®¡ç†åå°éœ€è¦èƒ½å¤Ÿï¼š

1. æŸ¥çœ‹å½“å‰æ”¯æŒçš„å¼€å¥–ç®—æ³•åˆ—è¡¨
2. é…ç½®ç®—æ³•å‚æ•°ï¼ˆå¦‚VRFå¯†é’¥ã€éšæœºç§å­ç­‰ï¼‰
3. æŸ¥çœ‹å†å²å¼€å¥–è®°å½•å’Œç®—æ³•éªŒè¯æ•°æ®
4. æ‰‹åŠ¨è§¦å‘å¼€å¥–ï¼ˆç´§æ€¥æƒ…å†µï¼‰

***

### æ•°æ®åº“è¡¨ç»“æ„

#### è¡¨ï¼š`draw_algorithms`ï¼ˆç®—æ³•é…ç½®ï¼‰

```sql
CREATE TABLE draw_algorithms (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  name VARCHAR(50) UNIQUE NOT NULL,  -- 'standard', 'vrf', 'hash'
  display_name_i18n JSONB NOT NULL,
  -- ç¤ºä¾‹: {"zh": "æ ‡å‡†ç®—æ³•", "ru": "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹", "tg": "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ó£"}
  
  description_i18n JSONB,
  formula_i18n JSONB,
  -- ç®—æ³•å…¬å¼è¯´æ˜ï¼ˆå¤šè¯­è¨€ï¼‰
  
  is_active BOOLEAN DEFAULT true,
  is_default BOOLEAN DEFAULT false,
  
  config JSONB,
  -- ç®—æ³•ç‰¹å®šé…ç½®ï¼Œå¦‚:
  -- {"vrf_public_key": "...", "seed_source": "blockchain"}
  
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆå§‹åŒ–ç®—æ³•
INSERT INTO draw_algorithms (name, display_name_i18n, description_i18n, is_default) VALUES
('standard', 
 '{"zh": "æ ‡å‡†æ—¶é—´æˆ³ç®—æ³•", "ru": "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼", "tg": "ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ó£"}',
 '{"zh": "åŸºäºè®¢å•æ—¶é—´æˆ³æ±‚å’Œå–æ¨¡", "ru": "ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğº", "tg": "Ğ”Ğ°Ñ€ Ğ°ÑĞ¾ÑĞ¸ Ğ²Ğ°Ò›Ñ‚Ğ¸ Ñ„Ğ°Ñ€Ğ¼Ğ¾Ğ¸ÑˆÒ³Ğ¾"}',
 true),
 
('vrf', 
 '{"zh": "VRFå¯éªŒè¯éšæœºç®—æ³•", "ru": "VRF Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼Ñ‹Ğ¹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹", "tg": "VRF Ñ‚Ğ°ÑĞ¾Ğ´ÑƒÑ„Ğ¸Ğ¸ ÑĞ°Ğ½Ò·Ğ¸Ğ´Ğ°ÑˆĞ°Ğ²Ğ°Ğ½Ğ´Ğ°"}',
 '{"zh": "ä½¿ç”¨å¯éªŒè¯éšæœºå‡½æ•°ï¼Œå®Œå…¨é€æ˜", "ru": "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ", "tg": "Ğ˜ÑÑ‚Ğ¸Ñ„Ğ¾Ğ´Ğ°Ğ¸ Ñ„ÑƒĞ½ĞºÑĞ¸ÑĞ¸ ÑĞ°Ğ½Ò·Ğ¸Ğ´Ğ°ÑˆĞ°Ğ²Ğ°Ğ½Ğ´Ğ°"}',
 false);
```


#### è¡¨ï¼š`draw_logs`ï¼ˆå¼€å¥–æ—¥å¿—ï¼‰

```sql
CREATE TABLE draw_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  
  lottery_id UUID NOT NULL REFERENCES lotteries(id),
  algorithm_name VARCHAR(50) NOT NULL,
  
  -- è¾“å…¥å‚æ•°
  input_data JSONB NOT NULL,
  -- ç¤ºä¾‹: {"orders": [...], "timestamp_sum": 123456789, "total_shares": 1000}
  
  -- è®¡ç®—è¿‡ç¨‹
  calculation_steps JSONB,
  -- ç¤ºä¾‹: [{"step": 1, "description": "è®¡ç®—æ—¶é—´æˆ³æ€»å’Œ", "value": 123456789}, ...]
  
  -- è¾“å‡ºç»“æœ
  winning_number INTEGER NOT NULL,
  winner_user_id UUID,
  
  -- VRF ç‰¹æœ‰å­—æ®µ
  vrf_seed TEXT,
  vrf_proof TEXT,
  
  draw_time TIMESTAMP WITH TIME ZONE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```


***

### ç®¡ç†åå° UI è®¾è®¡

#### 1. ç®—æ³•ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å¥–ç®—æ³•ç®¡ç†                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å½“å‰æ”¯æŒçš„ç®—æ³•                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç®—æ³•åç§°          è¯´æ˜           çŠ¶æ€  é»˜è®¤â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ æ ‡å‡†æ—¶é—´æˆ³ç®—æ³•  åŸºäºè®¢å•æ—¶é—´    â—å¯ç”¨  â—  â”‚   â”‚
â”‚  â”‚ VRFç®—æ³•        å¯éªŒè¯éšæœº       â—å¯ç”¨     â”‚   â”‚
â”‚  â”‚ å“ˆå¸Œç®—æ³•        SHA256è®¡ç®—      â—‹ç¦ç”¨     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â”‚  [æŸ¥çœ‹ç®—æ³•è¯¦æƒ…] [é…ç½®å‚æ•°] [æŸ¥çœ‹éªŒè¯æ•°æ®]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### 2. ç®—æ³•é…ç½®è¯¦æƒ…ï¼ˆä»¥ VRF ä¸ºä¾‹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VRF ç®—æ³•é…ç½®                          [ä¿å­˜]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç®—æ³•è¯´æ˜                                        â”‚
â”‚  VRF (Verifiable Random Function) å¯éªŒè¯éšæœºå‡½æ•° â”‚
â”‚  é€šè¿‡å¯†ç å­¦æ–¹å¼ç¡®ä¿éšæœºæ€§ï¼Œæ‰€æœ‰äººå¯éªŒè¯ç»“æœ      â”‚
â”‚                                                  â”‚
â”‚  é…ç½®å‚æ•°                                        â”‚
â”‚  VRF å…¬é’¥: [____________________________]       â”‚
â”‚  VRF ç§é’¥: [____________________________]       â”‚
â”‚  éšæœºæº:   [â—‹ åŒºå—é“¾å“ˆå¸Œ  â— æœåŠ¡å™¨ç†µæ± ]        â”‚
â”‚                                                  â”‚
â”‚  ç®—æ³•å…¬å¼                                        â”‚
â”‚  [ä¸­æ–‡] [Ğ ÑƒÑÑĞºĞ¸Ğ¹] [Ğ¢Ğ¾Ò·Ğ¸ĞºÓ£]                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. è·å–VRFç§å­ (åŒºå—é«˜åº¦å“ˆå¸Œ)           â”‚   â”‚
â”‚  â”‚ 2. ä½¿ç”¨ç§é’¥è®¡ç®—VRFè¾“å‡ºå’Œè¯æ˜            â”‚   â”‚
â”‚  â”‚ 3. ä¸­å¥–å· = VRFè¾“å‡º mod æ€»ä»½æ•°          â”‚   â”‚
â”‚  â”‚ 4. ä»»ä½•äººå¯ç”¨å…¬é’¥éªŒè¯è¯æ˜               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### 3. å¼€å¥–è®°å½•é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å¥–è®°å½•                     [å¯¼å‡ºéªŒè¯æ•°æ®]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´          æ´»åŠ¨      ç®—æ³•     ä¸­å¥–å·  éªŒè¯   â”‚
â”‚  11-17 20:00  #12345  æ ‡å‡†ç®—æ³•    456   [æŸ¥çœ‹]  â”‚
â”‚  11-17 18:00  #12344  VRFç®—æ³•     123   [æŸ¥çœ‹]  â”‚
â”‚  11-16 20:00  #12340  æ ‡å‡†ç®—æ³•    789   [æŸ¥çœ‹]  â”‚
â”‚  ...                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// ç‚¹å‡»"æŸ¥çœ‹"å¼¹å‡ºéªŒè¯è¯¦æƒ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å¥–éªŒè¯æ•°æ® - #12345                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ´»åŠ¨ID: 12345                                  â”‚
â”‚  ç®—æ³•: æ ‡å‡†æ—¶é—´æˆ³ç®—æ³•                            â”‚
â”‚  å¼€å¥–æ—¶é—´: 2025-11-17 20:00:00                  â”‚
â”‚                                                  â”‚
â”‚  è¾“å…¥æ•°æ®:                                       â”‚
â”‚  â€¢ æ€»ä»½æ•°: 1000                                 â”‚
â”‚  â€¢ è®¢å•æ•°: 856                                  â”‚
â”‚  â€¢ æ—¶é—´æˆ³æ€»å’Œ: 1,479,234,567,890                â”‚
â”‚                                                  â”‚
â”‚  è®¡ç®—è¿‡ç¨‹:                                       â”‚
â”‚  1. æ”¶é›†æ‰€æœ‰è®¢å•æ—¶é—´æˆ³                          â”‚
â”‚  2. è®¡ç®—æ€»å’Œ: 1,479,234,567,890                 â”‚
â”‚  3. å–æ¨¡è¿ç®—: 1479234567890 % 1000 = 890       â”‚
â”‚  4. ä¸­å¥–å·ç : 890                               â”‚
â”‚                                                  â”‚
â”‚  ä¸­å¥–ç”¨æˆ·: user12345 (@username)                â”‚
â”‚                                                  â”‚
â”‚  [ä¸‹è½½éªŒè¯æ•°æ®JSON] [æŸ¥çœ‹åŒºå—é“¾è¯æ˜]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

### åç«¯ API å®ç°

#### è·å–ç®—æ³•åˆ—è¡¨

```typescript
// GET /api/admin/draw-algorithms
async function getDrawAlgorithms() {
  const { data, error } = await supabase
    .from('draw_algorithms')
    .select('*')
    .eq('is_active', true)
    .order('is_default', { ascending: false })

  if (error) throw error
  return data
}
```


#### æ›´æ–°ç®—æ³•é…ç½®

```typescript
// PUT /api/admin/draw-algorithms/:name
async function updateAlgorithmConfig(name: string, config: any) {
  const { error } = await supabase
    .from('draw_algorithms')
    .update({ config, updated_at: new Date().toISOString() })
    .eq('name', name)

  if (error) throw error
  return { success: true }
}
```


#### æ‰‹åŠ¨è§¦å‘å¼€å¥–

```typescript
// POST /api/admin/lotteries/:id/draw
async function manualDraw(lotteryId: string, algorithmName: string) {
  // 1. éªŒè¯æ´»åŠ¨çŠ¶æ€
  const lottery = await getLottery(lotteryId)
  if (lottery.status !== 'SOLD_OUT') {
    throw new Error('åªæœ‰å·²å”®ç½„çš„æ´»åŠ¨æ‰èƒ½æ‰‹åŠ¨å¼€å¥–')
  }

  // 2. è·å–ç®—æ³•
  const algorithm = await getAlgorithm(algorithmName)

  // 3. æ‰§è¡Œå¼€å¥–
  const result = await executeDrawAlgorithm(lottery, algorithm)

  // 4. è®°å½•æ—¥å¿—
  await supabase.from('draw_logs').insert({
    lottery_id: lotteryId,
    algorithm_name: algorithmName,
    input_data: result.inputData,
    calculation_steps: result.steps,
    winning_number: result.winningNumber,
    winner_user_id: result.winnerId,
    vrf_seed: result.vrfSeed,
    vrf_proof: result.vrfProof,
    draw_time: new Date().toISOString()
  })

  // 5. æ›´æ–°æ´»åŠ¨çŠ¶æ€
  await supabase
    .from('lotteries')
    .update({
      status: 'FINISHED',
      winning_number: result.winningNumber,
      winner_user_id: result.winnerId,
      draw_time: new Date().toISOString()
    })
    .eq('id', lotteryId)

  return result
}
```


***

## æ€»ç»“ä¸å®æ–½æ£€æŸ¥æ¸…å•

### âœ… åŠŸèƒ½å®æ–½æ¸…å•

- [ ] **å¤ºå®ç®¡ç†å¤šè¯­è¨€**
    - [ ] æ•°æ®åº“è¡¨æ·»åŠ  `name_i18n`, `description_i18n`, `details_i18n` å­—æ®µ
    - [ ] ç®¡ç†åå°è¡¨å•æ”¯æŒä¸‰è¯­è¨€ Tab åˆ‡æ¢
    - [ ] å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é›†æˆ
    - [ ] å‰ç«¯è¯»å–å¤šè¯­è¨€å†…å®¹å¹¶æ ¹æ®ç”¨æˆ·è¯­è¨€æ˜¾ç¤º
- [ ] **å……å€¼é“¶è¡Œå‚æ•°é…ç½®**
    - [ ] åˆ›å»º `payment_methods` è¡¨
    - [ ] ç®¡ç†åå°æ·»åŠ æ”¯ä»˜æ–¹å¼é…ç½®é¡µé¢
    - [ ] æ”¯æŒå¤šè¯­è¨€é“¶è¡Œä¿¡æ¯å½•å…¥
    - [ ] å‰ç«¯å……å€¼é¡µé¢ä»æ•°æ®åº“è¯»å–é“¶è¡Œä¿¡æ¯
- [ ] **å¤šå±‚çº§ç”¨æˆ·ç®¡ç†**
    - [ ] æ‰©å±• `users` è¡¨æ·»åŠ æ¨èå…³ç³»å­—æ®µ
    - [ ] åˆ›å»º `commission_settings` å’Œ `commissions` è¡¨
    - [ ] ç®¡ç†åå°æ·»åŠ è¿”åˆ©è®¾ç½®é¡µé¢
    - [ ] ç®¡ç†åå°æ·»åŠ ç”¨æˆ·é‚€è¯·æ ‘é¡µé¢
    - [ ] ç®¡ç†åå°æ·»åŠ è¿”åˆ©è®°å½•ç®¡ç†é¡µé¢
- [ ] **å¼€å¥–ç®—æ³•ç®¡ç†**
    - [ ] åˆ›å»º `draw_algorithms` å’Œ `draw_logs` è¡¨
    - [ ] ç®¡ç†åå°æ·»åŠ ç®—æ³•ç®¡ç†é¡µé¢
    - [ ] ç®¡ç†åå°æ·»åŠ å¼€å¥–è®°å½•æŸ¥çœ‹é¡µé¢
    - [ ] å®ç°æ‰‹åŠ¨è§¦å‘å¼€å¥–æ¥å£
    - [ ] æä¾›éªŒè¯æ•°æ®ä¸‹è½½åŠŸèƒ½

***

**æ­¤æ–‡æ¡£è¯¦å°½è¦†ç›–äº†æ‰€æœ‰è¡¥å……éœ€æ±‚çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¯ç›´æ¥äº¤ä»˜ AI å·¥ç¨‹å¸ˆå®æ–½ã€‚**

